
{% extends "core/base.html" %}
{% block content %}
<h2>Checkout</h2>
<div class="row">
  <div class="col-md-7">
    <form method="post" novalidate>{% csrf_token %}
      <div class="mb-3"><label class="form-label">Método de envío</label>{{ form.metodo_envio }}</div>
      <div id="envio-fields">
        <div class="row g-2">
          <div class="col-md-8">{{ form.nombre.label_tag }} {{ form.nombre }}</div>
          <div class="col-md-4">{{ form.telefono.label_tag }} {{ form.telefono }}</div>
          <div class="col-md-8">{{ form.calle.label_tag }} {{ form.calle }}</div>
          <div class="col-md-4">{{ form.numero.label_tag }} {{ form.numero }}</div>
          <div class="col-md-6">{{ form.ciudad.label_tag }} {{ form.ciudad }}</div>
          <div class="col-md-6">{{ form.provincia.label_tag }} {{ form.provincia }}</div>
          <div class="col-md-6">{{ form.codigo_postal.label_tag }} {{ form.codigo_postal }}</div>
          <div class="col-12">{{ form.aclaraciones.label_tag }} {{ form.aclaraciones }}</div>
        </div>
      </div>
      <button class="btn btn-primary mt-3">Confirmar pedido</button>
    </form>
  </div>
  <div class="col-md-5">
    <h4>Resumen</h4>
    <ul class="list-group mb-3">
      {% for item in cart %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ item.product.nombre }} (x{{ item.quantity }})
        <span>$ {{ item.subtotal }}</span>
      </li>
      {% endfor %}
      <li class="list-group-item d-flex justify-content-between"><strong>Total</strong><strong>$ {{ total }}</strong></li>
    </ul>
  </div>
</div>
<script>
function toggleEnvioFields(){const rs=document.querySelectorAll('input[name="metodo_envio"]');let v="retiro";rs.forEach(r=>{if(r.checked)v=r.value});document.getElementById("envio-fields").style.display=(v==="envio")?"block":"none";}
document.addEventListener("change",e=>{if(e.target.name==="metodo_envio")toggleEnvioFields()});
document.addEventListener("DOMContentLoaded",toggleEnvioFields);
</script>
{% endblock %}
